# Context.md - Tropical TCG Players

## ¬øQu√© es Tropical TCG Players?

Tropical TCG Players es una **plataforma web integral para jugadores locales de Trading Card Games (TCG)** que busca conectar a la comunidad de coleccionistas y jugadores de cartas, proporcionando herramientas esenciales para el comercio, organizaci√≥n de eventos y gesti√≥n de colecciones.

## Prop√≥sito y Objetivos

### Objetivo Principal
Crear un ecosistema completo para la comunidad local de TCG que permita:
- **Comprar y vender cartas** de manera segura entre jugadores locales
- **Organizar y participar en eventos** de la comunidad
- **Gestionar colecciones personales** a trav√©s de binders digitales
- **Conectar jugadores** con intereses similares y facilitar el intercambio

### P√∫blico Objetivo
- Jugadores locales de TCG (Pok√©mon, One Piece, Dragon Ball, Magic, etc.)
- Coleccionistas de cartas
- Organizadores de eventos y torneos
- Tiendas locales de cartas

## Funcionalidades Principales

### üõí **Marketplace Especializado**
- **B√∫squeda espec√≠fica por TCG**: Pok√©mon, One Piece, Dragon Ball, Digimon, Magic: The Gathering, Union Arena, Gundam
- **Integraci√≥n con APIs oficiales**: Conecta con APIs externas para datos actualizados de cartas
- **Vendedores locales**: Sistema completo para que usuarios vendan sus cartas
- **Sistema de carrito**: Compra m√∫ltiple con gesti√≥n de inventario
- **Filtros avanzados**: Por rareza, condici√≥n, precio, tipo, etc.
- **Comparaci√≥n de precios**: Entre vendedores locales y referencias de mercado

### üìÖ **Sistema de Eventos**
- **Calendario interactivo**: Visualizaci√≥n de eventos de la comunidad
- **Panel de administraci√≥n**: Para organizadores gestionen eventos
- **Gesti√≥n completa**: Creaci√≥n, edici√≥n y seguimiento de eventos
- **Participaci√≥n**: Los usuarios pueden registrarse y participar

### üìÅ **Sistema de Binders (Colecciones)**
- **Binders personalizables**: Diferentes tipos (3x3, 4x4, 2x2, Jumbo) y estilos visuales
- **Gesti√≥n de colecciones**: Agregar, organizar y mostrar cartas
- **L√≠mite de 4 binders**: Para mantener la plataforma organizada
- **Visualizaci√≥n atractiva**: Diferentes temas de color para personalizaci√≥n

### üë§ **Sistema de Usuarios y Calificaciones**
- **Autenticaci√≥n completa**: Con Firebase Auth
- **Perfiles de usuario**: Con informaci√≥n, historial y calificaciones
- **Sistema de ratings**: Para vendedores y compradores
- **Historial de transacciones**: Seguimiento de compras y ventas

## Stack Tecnol√≥gico

### Frontend
- **React 18**: Framework principal con hooks modernos
- **Create React App**: Para configuraci√≥n y build
- **React Router DOM 7**: Navegaci√≥n SPA
- **Bootstrap 5.3**: Framework CSS para dise√±o responsivo
- **React Bootstrap**: Componentes Bootstrap para React
- **Framer Motion**: Animaciones y transiciones suaves

### Backend y Base de Datos
- **Firebase**: Plataforma backend completa
  - **Firestore**: Base de datos NoSQL para datos en tiempo real
  - **Firebase Auth**: Autenticaci√≥n de usuarios
  - **Firebase Storage**: Almacenamiento de archivos
  - **Firebase Hosting**: Para deployments

### Librer√≠as y Herramientas
- **React Icons**: Iconograf√≠a consistente
- **React Hot Toast**: Notificaciones elegantes
- **React Rating Stars**: Sistema de calificaciones
- **React Calendar**: Componentes de calendario
- **Date-fns & Moment**: Manipulaci√≥n de fechas
- **React Draggable**: Funcionalidades drag & drop

### APIs Externas
- **Pok√©mon TCG API**: Datos oficiales de cartas Pok√©mon
- **TCGAPIS.com**: APIs para One Piece, Dragon Ball, Digimon, Magic, Union Arena, Gundam
- **Proxy personalizado**: Para manejar CORS y centralizar requests

### Deployment y Hosting
- **Vercel**: Hosting principal con CI/CD autom√°tico
- **Variables de entorno**: Configuraci√≥n segura de API keys

## Arquitectura del Proyecto

### Estructura de Carpetas
```
src/
‚îú‚îÄ‚îÄ components/          # Componentes reutilizables
‚îú‚îÄ‚îÄ contexts/           # Context APIs (CarritoContext)
‚îú‚îÄ‚îÄ hooks/              # Custom hooks
‚îú‚îÄ‚îÄ pages/              # P√°ginas principales
‚îú‚îÄ‚îÄ services/           # Servicios (APIs, utilidades)
‚îú‚îÄ‚îÄ styles/             # Estilos CSS globales
‚îî‚îÄ‚îÄ assets/             # Recursos est√°ticos
```

### Componentes Clave
- **Navbar**: Navegaci√≥n principal con autenticaci√≥n
- **Marketplace**: Motor de b√∫squeda y listado de cartas
- **CardDetailModal**: Vista detallada de cartas con vendedores
- **SellCardModal**: Interface para vender cartas
- **EventCalendar**: Calendario interactivo de eventos
- **AuthModal**: Sistema de login/registro
- **RatingSystem**: Calificaciones de usuarios

### Gesti√≥n de Estado
- **Context API**: Para estado global (carrito, usuario)
- **Local Storage**: Persistencia temporal
- **Firebase**: Estado persistente en la nube
- **useState/useEffect**: Estado local de componentes

## Caracter√≠sticas T√©cnicas Destacadas

### üîç **B√∫squeda Inteligente**
- B√∫squeda espec√≠fica por TCG con debouncing
- Normalizaci√≥n de datos de m√∫ltiples APIs
- Cache inteligente para mejorar rendimiento
- Fallbacks a datos mock cuando las APIs fallan
- Paginaci√≥n eficiente

### üõ°Ô∏è **Seguridad**
- Autenticaci√≥n robusta con Firebase
- Validaci√≥n de permisos en frontend y backend
- Variables de entorno para API keys
- Sanitizaci√≥n de datos de entrada

### üì± **Experiencia de Usuario**
- **Responsive Design**: Funciona en m√≥viles, tablets y desktop
- **Progressive Enhancement**: Funcionalidades que mejoran gradualmente
- **Loading States**: Spinners y estados de carga elegantes
- **Error Handling**: Manejo graceful de errores con fallbacks

### ‚ö° **Performance**
- **Code Splitting**: Carga optimizada de componentes
- **Image Optimization**: Manejo eficiente de im√°genes de cartas
- **API Caching**: Cache inteligente con timeouts
- **Debounced Search**: B√∫squedas optimizadas

## Estado Actual del Proyecto

### ‚úÖ **Funcionalidades Completadas**
- Marketplace completamente funcional con b√∫squeda especializada
- Sistema de usuarios y autenticaci√≥n
- Sistema de eventos con panel administrativo
- Sistema de binders para colecciones
- Sistema de carrito y transacciones
- Integraci√≥n completa con APIs de TCG
- Interface responsive y moderna

### üöß **En Desarrollo/Mejoras Pendientes**
- Optimizaciones para producci√≥n en el marketplace
- Sistema de calificaciones m√°s robusto
- Mejoras en el sistema de reportes
- Funcionalidades adicionales de filtrado
- Integraci√≥n con m√©todos de pago

### üéØ **Pr√≥ximos Pasos**
El proyecto est√° en fase avanzada de desarrollo, con el marketplace siendo la funcionalidad principal que necesita optimizaci√≥n para el lanzamiento p√∫blico. La aplicaci√≥n est√° lista para ser desplegada y usada por la comunidad local de TCG.

## Configuraci√≥n de Desarrollo

### Variables de Entorno Requeridas
```
REACT_APP_FIREBASE_API_KEY=
REACT_APP_FIREBASE_AUTH_DOMAIN=
REACT_APP_FIREBASE_PROJECT_ID=
REACT_APP_FIREBASE_STORAGE_BUCKET=
REACT_APP_FIREBASE_MESSAGING_SENDER_ID=
REACT_APP_FIREBASE_APP_ID=
REACT_APP_FIREBASE_MEASUREMENT_ID=
REACT_APP_POKEMON_API_KEY=
REACT_APP_TCG_API_KEY=
```

### Comandos Principales
```bash
npm start          # Servidor de desarrollo
npm run build      # Build para producci√≥n  
npm test           # Tests unitarios
```

## Valor de la Plataforma

Tropical TCG Players no es solo una aplicaci√≥n de compra-venta, es un **hub completo para la comunidad TCG local** que:

- **Reduce la fragmentaci√≥n** del mercado local de cartas
- **Facilita el discovery** de eventos y actividades
- **Proporciona herramientas profesionales** para gesti√≥n de colecciones
- **Crea confianza** a trav√©s del sistema de ratings
- **Centraliza la informaci√≥n** relevante para jugadores
- **Fomenta la comunidad** local de TCG

La plataforma est√° dise√±ada para ser escalable y adaptarse a diferentes mercados locales, siendo Costa Rica el mercado piloto inicial.

---

## üéâ **ACTUALIZACI√ìN DE IMPLEMENTACI√ìN - ENERO 2025**

### ‚úÖ **SPRINT 1 COMPLETADO - BASE DE DATOS Y BACKEND**

**Fecha de finalizaci√≥n:** Enero 2025
**Estado:** ‚úÖ COMPLETAMENTE IMPLEMENTADO

#### **FASES IMPLEMENTADAS:**

**FASE 1.1: ACTUALIZACI√ìN DE COLECCIONES EXISTENTES** ‚úÖ
- ‚úÖ Colecci√≥n `users` migrada con 6 campos nuevos para P2P
- ‚úÖ Colecci√≥n `listings` extendida con campos de reservas y env√≠o
- ‚úÖ Colecci√≥n `transactions` completamente reestructurada para flujo P2P

**FASE 1.2: NUEVAS COLECCIONES CREADAS** ‚úÖ  
- ‚úÖ `stores` - 12 tiendas configuradas en Costa Rica (2 por provincia)
- ‚úÖ `pendingTransactions` - Sistema de reservas temporales
- ‚úÖ `notifications` - Sistema de notificaciones multi-canal
- ‚úÖ `disputes` - Sistema de reportes y disputas
- ‚úÖ `userRecommendations` - Sistema de "likes" a perfiles

**FASE 1.3: CLOUD FUNCTIONS B√ÅSICAS** ‚úÖ
- ‚úÖ 3 Funciones de migraci√≥n implementadas y probadas
- ‚úÖ 3 Funciones de poblaci√≥n de datos operativas
- ‚úÖ 2 Funciones de verificaci√≥n y status
- ‚úÖ Node.js 18 + TypeScript + Firebase Admin SDK

**FASE 1.4: CONFIGURACI√ìN APIS EXTERNAS** ‚úÖ
- ‚úÖ Firebase Functions configurado en `firebase.json`
- ‚úÖ Firestore Rules actualizadas para todas las colecciones P2P
- ‚úÖ Firestore Indexes optimizados para consultas P2P
- ‚úÖ Variables de entorno completas en `.env.example`
- ‚úÖ MigrationHelper creado para ejecutar configuraci√≥n completa

#### **ARCHIVOS IMPLEMENTADOS:**
- ‚úÖ `functions/` - Directorio completo de Cloud Functions
- ‚úÖ `src/utils/migrationHelper.js` - Helper para migraciones
- ‚úÖ `SPRINT1_COMPLETED.md` - Documentaci√≥n completa de implementaci√≥n
- ‚úÖ `firestore.rules` - Reglas de seguridad actualizadas
- ‚úÖ `firestore.indexes.json` - √çndices optimizados

#### **C√ìMO EJECUTAR LA CONFIGURACI√ìN:**
```javascript
// En consola del navegador (una vez desplegadas las Cloud Functions)
window.migrationHelper.runCompleteSetup()
```

#### **PR√ìXIMO PASO:**
üöÄ **SPRINT 3 - COMPONENTES UI** (Listo para implementar)

---

### ‚úÖ **SPRINT 2 COMPLETADO - SERVICIOS Y CONTEXTOS**

**Fecha de finalizaci√≥n:** Enero 2025
**Estado:** ‚úÖ COMPLETAMENTE IMPLEMENTADO

#### **FASES IMPLEMENTADAS:**

**FASE 2.1: EXTENSI√ìN DE CARTCONTEXT** ‚úÖ
- ‚úÖ 10 nuevas funciones P2P agregadas al CartContext
- ‚úÖ Verificaci√≥n at√≥mica de disponibilidad
- ‚úÖ Sistema de transacciones P2P con reserva de inventario
- ‚úÖ Agrupaci√≥n multi-vendedor del carrito
- ‚úÖ Integraci√≥n completa con Cloud Functions

**FASE 2.2: TRANSACTIONCONTEXT COMPLETO** ‚úÖ  
- ‚úÖ Context dedicado para transacciones P2P
- ‚úÖ Escucha en tiempo real de transacciones
- ‚úÖ 8 funciones principales para gesti√≥n de transacciones
- ‚úÖ Funciones de utilidad para UI (estados, tiempos, acciones)
- ‚úÖ Sistema de notificaciones no le√≠das autom√°tico

**FASE 2.3: SERVICIO DE NOTIFICACIONES** ‚úÖ
- ‚úÖ NotificationService centralizado multi-canal
- ‚úÖ 8 tipos de notificaciones P2P automatizadas  
- ‚úÖ Templates espec√≠ficos para cada fase de transacci√≥n
- ‚úÖ Sistema de fallbacks y manejo de errores
- ‚úÖ Configuraci√≥n desde variables de entorno

**FASE 2.4: WHATSAPP Y EMAIL SERVICES** ‚úÖ
- ‚úÖ WhatsAppService con 9 templates de mensajes
- ‚úÖ Integraci√≥n WhatsApp Business API completa
- ‚úÖ EmailService con templates HTML profesionales
- ‚úÖ Integraci√≥n Brevo API para emails
- ‚úÖ Sistema de pruebas para desarrollo

**FASE 2.5: HOOKS PERSONALIZADOS** ‚úÖ
- ‚úÖ useP2PTransactions: Hook maestro para transacciones
- ‚úÖ useNotifications: Hook para sistema de notificaciones
- ‚úÖ 15+ funciones de utilidad para componentes UI
- ‚úÖ Validaci√≥n de datos y manejo de errores
- ‚úÖ Estad√≠sticas y filtros avanzados

#### **ARCHIVOS IMPLEMENTADOS:**
- ‚úÖ `src/contexts/CartContext.js` - Extendido con 10 funciones P2P
- ‚úÖ `src/contexts/TransactionContext.js` - Context completo para transacciones
- ‚úÖ `src/services/NotificationService.js` - Servicio centralizado de notificaciones
- ‚úÖ `src/services/WhatsAppService.js` - Servicio especializado WhatsApp
- ‚úÖ `src/services/EmailService.js` - Servicio especializado Email
- ‚úÖ `src/hooks/useP2PTransactions.js` - Hook principal para P2P
- ‚úÖ `src/hooks/useNotifications.js` - Hook para notificaciones

#### **INTEGRACI√ìN COMPLETA:**
- ‚úÖ Todos los servicios integrados con Cloud Functions
- ‚úÖ Sistema de configuraci√≥n desde .env variables
- ‚úÖ Manejo de errores y fallbacks en toda la cadena
- ‚úÖ Hooks listos para usar en componentes UI
- ‚úÖ Sistema de notificaciones multi-canal operativo

---

## üîÑ **FLUJO COMPLETO DE COMPRA/VENTA P2P**

### Objetivo del Sistema
Sistema **peer-to-peer (P2P)** completo que permite a usuarios comprar y vender cartas de forma segura mediante un flujo estructurado con verificaciones, notificaciones autom√°ticas y sistema de calificaciones mutuas.

### üõí **FASE 1: PROCESO DE COMPRA**

#### 1.1 Agregar al Carrito
- **Verificaci√≥n at√≥mica:** Al confirmar compra se verifica stock real en tiempo real
- **Reserva temporal:** Reduce `availableQuantity` inmediatamente para evitar sobreventa
- **Carrito multi-vendedor:** Agrupa items por vendedor autom√°ticamente

#### 1.2 Checkout por Vendedor
**Layout del Checkout:**
```
üõí CONFIRMAR COMPRAS

üì¶ VENDEDOR A (Juan P√©rez) - Total: ‚Ç°15,000
‚îú‚îÄ‚îÄ 2x Charizard ‚Ç°5,000 c/u
‚îî‚îÄ‚îÄ 3x Luffy ‚Ç°1,500 c/u
[Confirmar compra con Vendedor A] [Env√≠o: +‚Ç°600]

üì¶ VENDEDOR B (Mar√≠a L√≥pez) - Total: ‚Ç°3,000  
‚îî‚îÄ‚îÄ 1x Pikachu ‚Ç°3,000
[Confirmar compra con Vendedor B] [Env√≠o gratis]
```

- **Transacciones separadas:** Una transacci√≥n independiente por cada vendedor
- **Confirmaci√≥n individual:** Cada vendedor maneja su propia transacci√≥n
- **Gesti√≥n de env√≠o:** El vendedor define si cobra env√≠o (‚Ç°600 fijos) al crear listing

#### 1.3 Confirmaci√≥n de Compra
- **Estado inicial:** `pending_seller_response`
- **Notificaci√≥n inmediata:** WhatsApp autom√°tico al vendedor con template predefinido
- **Timer de 24 horas:** Inicia countdown para respuesta del vendedor

### ‚è∞ **FASE 2: RESPUESTA DEL VENDEDOR (24h l√≠mite)**

#### 2.1 Opciones del Vendedor
- **‚úÖ Acepta la compra:**
  - Estado ‚Üí `accepted_pending_delivery`
  - Notificaci√≥n WhatsApp al comprador con datos del vendedor
  - Timer de 6 d√≠as para entrega
  
- **‚ùå Rechaza la compra:**
  - Estado ‚Üí `cancelled`
  - Restaurar `availableQuantity` al inventario
  - Notificaci√≥n al comprador del rechazo
  
- **‚è∞ No responde en 24h:**
  - Auto-cancelaci√≥n por Cloud Function
  - Restaurar inventario autom√°ticamente
  - Penalizaci√≥n leve al vendedor

### üì¶ **FASE 3: PROCESO DE ENTREGA (6 d√≠as l√≠mite)**

#### 3.1 Coordinaci√≥n de Entrega
- **Red de tiendas:** Costa Rica tiene tiendas afiliadas en todas las provincias (m√≠nimo 2 por provincia)
- **Selecci√≥n de tiendas:**
  - **Vendedor:** Selecciona tienda de origen para dejar la carta
  - **Comprador:** Selecciona tienda de destino para recoger
- **Env√≠o entre tiendas:** Sistema manual de env√≠os (futuro: sistema propio de tracking)

#### 3.2 Confirmaci√≥n de Entrega
- **Vendedor debe:**
  1. **Ir a la tienda** y entregar la carta
  2. **Subir foto como prueba:** Sobre con nombre del comprador + las cartas compradas
  3. **Confirmar entrega** en la app
  
- **Al confirmar entrega:**
  - Estado ‚Üí `delivered_pending_payment`
  - Se activa modal de solicitud de pago

#### 3.3 Timeout de Entrega
- **Si no entrega en 6 d√≠as:**
  - Auto-cancelaci√≥n por Cloud Function
  - **Penalizaci√≥n severa** al vendedor (p√©rdida de puntos significativa)
  - Posible suspensi√≥n temporal
  - Restaurar inventario

### üí≥ **FASE 4: PROCESO DE PAGO**

#### 4.1 Solicitud de Pago
**Modal post-entrega con opciones:**
- **Opci√≥n recomendada:** Bot√≥n WhatsApp con template de solicitud de pago
- **Opci√≥n alternativa:** "Ya pagado" (si se negoci√≥ pago presencial)

#### 4.2 M√©todos de Pago Aceptados
- **Sinpe M√≥vil** (principal)
- **Efectivo** (coordinado presencialmente)
- **Intercambio de cartas** (trueque con foto de prueba)
- **Otros m√©todos** negociados por WhatsApp

#### 4.3 Confirmaci√≥n de Pago
- **Vendedor:** Debe subir comprobante de pago recibido (screenshot Sinpe, etc.)
- **Comprador:** Debe confirmar que el pago fue realizado correctamente
- **Estado:** `payment_confirmed` ‚Üí Listo para finalizaci√≥n

### üìã **FASE 5: CONFIRMACI√ìN DE RECIBO (10 d√≠as l√≠mite)**

#### 5.1 Confirmaci√≥n del Comprador
- **Comprador debe:** Ir a la tienda de destino y recoger la carta
- **Confirmar recibo** en la app
- **Auto-confirmaci√≥n:** Si no confirma en 10 d√≠as, se confirma autom√°ticamente

### ‚≠ê **FASE 6: SISTEMA DE CALIFICACIONES MUTUAS**

#### 6.1 Rating Obligatorio (7 d√≠as l√≠mite)
**Al completarse la transacci√≥n, aparecen 2 modales:**

```
Modal Comprador: "Califica al vendedor Juan (OBLIGATORIO)"
‚îú‚îÄ‚îÄ Estrellas: 1-5 (obligatorio)
‚îî‚îÄ‚îÄ Comentario: texto libre (opcional)

Modal Vendedor: "Califica al comprador Mar√≠a (OBLIGATORIO)"  
‚îú‚îÄ‚îÄ Estrellas: 1-5 (obligatorio)
‚îî‚îÄ‚îÄ Comentario: texto libre (opcional)
```

#### 6.2 Consecuencias del Rating
- **No calificar en 7 d√≠as:** Penalizaci√≥n autom√°tica (-0.1 puntos del rating personal)
- **Ratings positivos (4-5‚≠ê):** Mayor visibilidad en marketplace
- **Ratings negativos (1-2‚≠ê):** Menor visibilidad + investigaci√≥n admin
- **Estado final:** `completed` cuando ambos califican

### üèÜ **SISTEMA DE REPUTACI√ìN Y RECOMENDACIONES**

#### Sistema de "Likes" al Perfil
- **1 recomendaci√≥n por usuario:** Cada usuario puede dar m√°ximo 1 "like" a otro perfil
- **Reversible:** Se puede quitar y volver a dar
- **Visible p√∫blicamente:** Contador en perfil + lista de qui√©n recomend√≥

#### Perfil P√∫blico del Usuario
```
üë§ Juan P√©rez (@juanp)
üìã C√©dula verificada ‚úÖ | üì± Tel√©fono verificado ‚úÖ
‚≠ê 4.8/5 (127 valoraciones)
üëç 23 recomendaciones  
üì¶ 89 ventas completadas
üõí 12 compras realizadas
üìÖ Miembro desde: Enero 2024
üìç San Jos√©, Costa Rica
```

### üõ°Ô∏è **SISTEMA DE SEGURIDAD Y VERIFICACI√ìN**

#### Verificaci√≥n Obligatoria
- **C√©dula de identidad:** Obligatoria (mayores de 12 a√±os)
- **N√∫mero de tel√©fono:** Verificaci√≥n por SMS
- **Una cuenta por c√©dula:** Evita cuentas m√∫ltiples

#### Sistema Anti-Fraude
- **Fotos de entrega:** Obligatorias con datos del comprador visible
- **Comprobantes de pago:** Screenshot obligatorio
- **Historial de comportamiento:** Tracking de cancelaciones, entregas tard√≠as
- **Penalizaciones progresivas:** Desde warnings hasta suspensi√≥n permanente

### üì± **SISTEMA DE NOTIFICACIONES**

#### Canales de Notificaci√≥n
1. **WhatsApp (principal):** Templates autom√°ticos para cada fase
2. **Email (backup):** Usando Brevo API o similar 
3. **In-app (web):** Notificaciones en tiempo real
4. **SMS (futuro):** Para casos cr√≠ticos

#### Templates de WhatsApp
```
üì± Al vendedor: "üéØ Nueva compra de [cardName] por ‚Ç°[price]. Tienes 24h para responder: [appLink]"
üì± Al comprador: "‚úÖ Tu compra fue aceptada por [sellerName]. Coordina entrega: [sellerPhone]"
üì± Recordatorio entrega: "‚è∞ Recordatorio: Tienes 2 d√≠as restantes para entregar [cardName]"
üì± Pago solicitado: "üí∞ [sellerName] confirm√≥ la entrega. Procede con el pago acordado"
```

### üö® **SISTEMA DE DISPUTAS Y MODERACI√ìN**

#### Tipos de Disputas
- **Producto no recibido**
- **Producto diferente al descrito**
- **Pago no recibido** 
- **Problemas de comunicaci√≥n**

#### Proceso de Disputa
1. **Reporte por usuario** con evidencia
2. **Revisi√≥n admin** (inicialmente manual)
3. **Investigaci√≥n** con ambas partes
4. **Resoluci√≥n** con compensaci√≥n si aplica
5. **Medidas correctivas** (warnings, suspensiones)

### üîÑ **ESTADOS DE TRANSACCI√ìN COMPLETOS**

```
üìä FLUJO DE ESTADOS:
pending_seller_response (24h l√≠mite)
    ‚îú‚îÄ‚îÄ accepted_pending_delivery (6 d√≠as l√≠mite)
    ‚îÇ   ‚îú‚îÄ‚îÄ delivered_pending_payment
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment_confirmed
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ completed (con ratings)
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ disputed
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ payment_disputed
    ‚îÇ   ‚îî‚îÄ‚îÄ delivery_timeout (auto-cancel)
    ‚îú‚îÄ‚îÄ cancelled_by_seller
    ‚îî‚îÄ‚îÄ timeout_cancelled (auto-cancel)
```

### ‚öôÔ∏è **IMPLEMENTACI√ìN T√âCNICA REQUERIDA**

#### Cloud Functions Necesarias
1. **Transaction Timeouts:** Auto-cancelar transacciones vencidas
2. **Notification Sender:** Env√≠o autom√°tico de WhatsApp/Email
3. **Inventory Manager:** Restaurar stock en cancelaciones
4. **Rating Enforcer:** Penalizar usuarios que no califican

#### Nuevas Colecciones Firebase
```javascript
// pendingTransactions: Manejo de reservas temporales
// notifications: Sistema de notificaciones
// disputes: Sistema de reportes
// userRecommendations: Sistema de "likes" a perfiles
```

---